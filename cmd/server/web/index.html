<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSAgents Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css"/>
</head>
<body class="bg-gray-900">
    <div class="container">
        <!-- Header -->
        <header>
            <h1 class="text-4xl font-bold text-gray-100 text-center mb-2">PSAgent - Your Personal Sovereign Agent</h1>
            <p class="text-gray-300 text-center text-xl italic">Empowering You with AI-Driven Autonomy</p>
        </header>

        <!-- Chat Container -->
        <div id="chat-container" class="flex flex-col flex-1 overflow-y-auto p-4 space-y-4">
            <template id="user-message-template">
                <div class="message user-message flex justify-end">
                    <div class="message-text bg-blue-600 text-white px-4 py-2 rounded-2xl max-w-[80%] break-words shadow-md">
                    </div>
                </div>
            </template>

            <template id="assistant-message-template">
                <div class="message assistant-message flex justify-start">
                    <div class="flex flex-col max-w-[80%]">
                        <div class="message-text bg-gray-700 text-white px-4 py-2 rounded-2xl break-words shadow-md">
                        </div>
                        <div class="metadata-container text-sm">
                            <div class="flex items-center gap-4 text-gray-400">
                                <span class="confidence-info flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="confidence-value"></span>
                                </span>
                                <span class="strategy-info flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                    <span class="strategy-value"></span>
                                </span>
                            </div>
                            <div class="evidence-info mt-2">
                                <span class="text-gray-400">Grounding:</span>
                                <div class="evidence-links flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <template id="loading-template">
                <div class="message assistant-message flex justify-start">
                    <div class="loading-dots">Thinking</div>
                </div>
            </template>
        </div>

        <!-- Input Form -->
        <form id="chat-form" class="flex flex-col gap-4">
            <div class="relative">
                <input type="text"
                       id="user-input"
                       class="w-full p-4 border rounded-lg bg-gray-800 text-gray-100 border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="Type your message here..."
                       required>
            </div>
            <div class="flex gap-4 items-center">
                <button type="submit"
                        class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex-shrink-0">
                    Send
                </button>
                <div class="relative inline-block">
                    <button id="strategy-button" type="button" class="flex items-center gap-2">
                        <span id="selected-strategy">Hybrid</span>
                        <svg class="w-4 h-4 transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="strategy-selector" class="strategy-selector hidden">
                        <div class="strategy-option" data-strategy="eval" 
                             data-tippy-content="Evaluation mode: Compares responses from all three strategies (Similarity → Semantic → Hybrid) to demonstrate how each strategy processes the same query differently. Useful for understanding strategy behaviors and selecting the most appropriate one for your use case.">
                            <span class="strategy-name">Eval (Compare All)</span>
                            <span class="strategy-checkmark">✓</span>
                        </div>
                        <div class="strategy-option" data-strategy="hybrid" 
                             data-tippy-content="Balances direct relevance with structural context. Retrieves 10 similar anchors, then expands each into 10 related messages. Uses both anchors and frontier messages (up to 110). Ideal when both surface similarity and inferred structure are important.">
                            <span class="strategy-name">Hybrid</span>
                        </div>
                        <div class="strategy-option" data-strategy="similarity" 
                             data-tippy-content="Fast retrieval of semantically similar messages via vector search. Retrieves top 100 similar messages without graph traversal. Best for shallow recall when only the most lexically or topically aligned content is sufficient. Fast, low-latency.">
                            <span class="strategy-name">Similarity (Vector)</span>
                        </div>
                        <div class="strategy-option" data-strategy="semantic" 
                             data-tippy-content="Leverages structural relationships (causality, elaboration) to infer deeper intent/context. Retrieves 10 anchors and only uses their graph-connected frontier nodes (up to 100). Uses graph-connected messages while ignoring superficial similarity.">
                            <span class="strategy-name">Semantic (LLM Knowledge Graph)</span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script src="config.js"></script>
    <script src="chat.js"></script>
</body>
</html>