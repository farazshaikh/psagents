<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSAgents Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css"/>
</head>
<body class="bg-gray-900">
    <div class="container">
        <!-- Header -->
        <header>
            <h1 class="text-4xl font-bold text-gray-100 text-center mb-2">PSAgent - Your Personal Sovereign Agent</h1>
            <p class="text-gray-300 text-center text-xl italic">Empowering You with AI-Driven Autonomy</p>
        </header>

        <!-- Chat Container -->
        <div id="chat-container" class="bg-gray-800 rounded-lg shadow-xl p-4">
            <!-- Messages will be inserted here -->
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden">
            <div class="flex justify-start mb-4">
                <div class="bg-gray-700 text-gray-100 rounded-lg py-2 px-4">
                    <div class="loading-dots"></div>
                </div>
            </div>
        </div>

        <!-- Input Form -->
        <form id="chat-form" class="flex flex-col gap-4">
            <div class="relative">
                <input type="text"
                       id="user-input"
                       class="w-full p-4 border rounded-lg bg-gray-800 text-gray-100 border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="Type your message here..."
                       required>
            </div>
            <div class="flex gap-4 items-center">
                <button type="submit"
                        class="bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex-shrink-0">
                    Send
                </button>
                <div class="relative">
                    <button id="strategy-button" type="button" class="strategy-button">
                        <span id="selected-strategy">Hybrid</span>
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="strategy-selector" class="strategy-selector hidden">
                        <div class="strategy-option" data-strategy="hybrid" data-tippy-content="Balances direct relevance with structural context. Retrieves 10 similar anchors, then expands each into 10 related messages. Uses both anchors and frontier messages (up to 110). Ideal when both surface similarity and inferred structure are important.">
                            <span class="strategy-name">Hybrid (Default)</span>
                            <span class="strategy-checkmark text-blue-400 ml-2">âœ“</span>
                        </div>
                        <div class="strategy-option" data-strategy="similarity" data-tippy-content="Fast retrieval of semantically similar messages via vector search. Retrieves top 100 similar messages without graph traversal. Best for shallow recall when only the most lexically or topically aligned content is sufficient. Fast, low-latency.">
                            <span class="strategy-name">Similarity</span>
                        </div>
                        <div class="strategy-option" data-strategy="semantic" data-tippy-content="Leverages structural relationships (causality, elaboration) to infer deeper intent/context. Retrieves 10 anchors and only uses their graph-connected frontier nodes (up to 100). Uses graph-connected messages while ignoring superficial similarity.">
                            <span class="strategy-name">Semantic</span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Message Templates -->
    <template id="user-message-template">
        <div class="flex justify-end mb-4">
            <div class="bg-blue-600 text-white rounded-lg py-2 px-4 max-w-[80%]">
                <p class="message-text"></p>
            </div>
        </div>
    </template>

    <template id="assistant-message-template">
        <div class="flex justify-start mb-4">
            <div class="bg-gray-700 text-gray-100 rounded-lg py-2 px-4 max-w-[80%]">
                <p class="message-text"></p>
                <div class="evidence-container mt-2 text-sm text-gray-300 flex flex-wrap gap-2"></div>
            </div>
        </div>
    </template>

    <script src="config.js"></script>
    <script src="chat.js"></script>
</body>
</html>